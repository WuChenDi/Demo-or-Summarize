# 通信类

* 什么是同源策略及限制
* 前后端如何通信
* 如何创建Ajax
* 跨域通信的几种方式

## 什么是同源策略及限制
同源策略限制从一个源加载的文档或脚本如何与来自另一个源的资源进行交互。这是一个用于隔离潜在恶意文件的关键的安全机制。
- cookie，localstorage和IndexDB无法读取
- DOM无法获取
- Ajax请求不能发送

## 前后端如何通信
- Ajax
- WebSocket
- CORS

## 如何创建Ajax（[code](https://github.com/WuChenDi/Front-End/blob/master/04-%E9%9D%A2%E8%AF%95/2018%E5%B9%B4%E5%BA%95Coding/jsonp.js)）
- XMLHttpRequest对象的工作流程
- 兼容性处理
- 事件的触发条件
- 事件的触发顺序

## 跨域通信的几种方式（[code](https://github.com/WuChenDi/Front-End/blob/master/04-%E9%9D%A2%E8%AF%95/2018%E5%B9%B4%E5%BA%95Coding/ajax.html)）
1. 通过JSONP跨域
2. CORS
3. document.domain + iframe跨域
4. location.hash + iframe
5. window.name + iframe跨域
6. postMessage
7. nginx代理跨域
8. nodejs中间件代理跨域
9. WebSocket协议跨域


- jsonp

    优缺点：

    1. JSONP是服务器与客户端跨源通信的常用方法。最大特点就是简单适用，老式浏览器全部支持，服务器改造非常小。

    2. 只能实现get一种请求、不安全 容易遭到xss攻击

- CORS

    CORS是一个W3C标准，全称是"跨域资源共享"（Cross-origin resource sharing）它允许浏览器向跨源服务器，发出XMLHttpRequest请求，从而克服了AJAX只能同源使用的限制。

    普通跨域请求：只服务端设置Access-Control-Allow-Origin即可，前端无须设置，若要带cookie请求：前后端都需要设置。由于同源策略的限制，所读取的cookie为跨域请求接口所在域的cookie，而非当前页

    优缺点：

    1. 目前，所有浏览器都支持该功能(IE8+：IE8/9需要使用XDomainRequest对象来支持CORS）)，CORS也已经成为主流的跨域解决方案。
    2. 整个CORS通信过程，都是浏览器自动完成，不需要用户参与。对于开发者来说，CORS通信与同源的AJAX通信没有差别，代码完全一样。浏览器一旦发现AJAX请求跨源，就会自动添加一些附加的头信息，有时还会多出一次附加的请求，但用户不会有感觉。
    3. CORS与JSONP的使用目的相同，但是比JSONP更强大。JSONP只支持GET请求，CORS支持所有类型的HTTP请求。JSONP的优势在于支持老式浏览器，以及可以向不支持CORS的网站请求数据。

- document.domain + iframe跨域

    此方案仅限主域相同，子域不同的跨域应用场景(网页一级域名相同，只是二级域名不同)。实现原理：两个页面都通过js强制设置document.domain为基础主域，就实现了同域。

    1. 父窗口：(www.a.com/a.html)
    ```js
    <iframe id="iframe" src="http://child.a.com/b.html"></iframe>
    <script>
        document.domain = 'a.com';
        var user = 'admin';
    </script>
    ```

    2. 子窗口：(child.a.com/b.html)
    ```js
    <script>
        document.domain = 'a.com';
        // 获取父窗口中变量
        alert('get js data from parent ---> ' + window.parent.user);
    </script>
    ```

- location.hash

